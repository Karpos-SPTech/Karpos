<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <link rel="shortcut icon" href="../sidebar/src/images/logo-contato.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../SiteDashboard/style-dashboard.css">
    <link rel="shortcut icon" href="../SiteDashboard/assets/logo-contato.png" type="image/x-icon">
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
    <title>Karpos</title>
</head>

<body>
    <nav id="sidebar">
        <div id="sidebar_content">
            <div id="user">
                <img src="../SiteDashboard/assets/logo-contato.png" id="user_avatar" alt="Avatar">

                <p id="user_infos">
                    <span class="item-description">
                        Karpos Dash
                    </span>
                    <span class="item-description">
                        Bem vindo
                    </span>
                </p>
            </div>

            <ul id="side_items">
                <li class="side-item active" id="btnAreaUsuario">
                    <a href="#">
                        <i class="fa-solid fa-user"></i>
                        <span class="item-description">
                            Área do usuário
                        </span>
                    </a>

                </li>

                <li class="side-item" id="btnAreaTemperatura">
                    <a href="#">
                        <i class="fa-solid fa-temperature-three-quarters"></i>
                        <span class="item-description">
                            Temperatura
                        </span>
                    </a>
                </li>

                <li class="side-item" id="btnAreaUmidade">
                    <a href="#">
                        <i class="fa-solid fa-droplet"></i>
                        <span class="item-description">
                            Umidade
                        </span>
                    </a>
                </li>

                <li class="side-item" id="btnAreaTabelas">
                    <a href="#">
                        <i class="fa-solid fa-table"></i>
                        <span class="item-description">
                            Tabelas
                        </span>
                    </a>
                </li>

                <li class="side-item" id="btnAreaExportar">
                    <a href="#">
                        <i class="fa-solid fa-file-export"></i>
                        <span class="item-description">
                            Exportar
                        </span>
                    </a>
                </li>
            </ul>

            <button id="open_btn">
                <i id="open_btn_icon" class="fa-solid fa-chevron-right"></i>
            </button>
        </div>

        <div id="logout">
            <button id="logout_btn" onclick="exit()">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span class="item-description">
                    Sair
                </span>
            </button>
        </div>
    </nav>
    <main id="main-class">
        <section id="section_umidade" style="display:none; width: 900px;">
            <h1 class="principal"> MONITORAMENTO DOS ALGODÕES</h1>
            <h1 class="titulograf">Análise de Umidade</h1>
            <canvas id="dht11Umidade"></canvas>
            <h1 class="titulograf">Situação Atual:</h1>
            <div id="alertasU">
                <div class="fazenda">
                    <img width="100px" height="100px" src="../SiteDashboard/assets/fazendaa.png" alt="">
                    Fazenda XPTO
                </div>
                <div id="tempo1"></div>
                <div id="umiData">Umidade Atual:</div>
                <div id="textboxUmi"></div>
            </div>
        </section>

        <section id="section_temperatura" style="display: none; width: 900px;">
            <h1 class="principal"> MONITORAMENTO DOS ALGODÕES</h1>
            <h1 class="titulograf">Análise de Temperatura</h1>
            <canvas id="lm35Temperatura"></canvas>
            
            <h1 class="titulograf">Dados Atuais:</h1>
            <div id="alertas">
                <div class="fazenda">
                    <img width="100px" height="100px" src="../SiteDashboard/assets/fazendaa.png" alt="">
                    Fazenda XPTO
                </div>
                <div id="tempo"></div>
                <div id="tempData">Temperatura Atual:</div>
                <div id="textboxTemp"></div>
            </div>
        </section>

        <section id="section_areaDoUsuario" style="display: block;">
            <h1>Área do Usuário - Dashboard</h1>
            <h3 class="mensagem">Seja bem-vindo à tela de monitoramento de dados da sua plantação de algodão! Fique
                atento aos nossos
                avisos para aprimorar sua produtividade e evitar problemas com fungos. Estamos aqui para ajudá-lo a
                obter os
                melhores resultados.</h3>

            <h3 class="nossosavisos">Nossos Avisos:</h3>
            <div class="nossos">
                <div class="cada">
                    <div class="boxbom">
                        <img width="50px" src="https://cdn-icons-png.flaticon.com/512/272/272340.png" alt="">
                        FAVORÁVEL
                    </div>
                    <p class="desc">Tudo sob controle, mas continue monitorando para garantir a estabilidade e o
                        crescimento saudável da plantação. </p>
                </div>
                <div class="cada">
                    <div class="boxcuidado">
                        <img width="50px" src="https://cdn-icons-png.flaticon.com/512/272/272340.png" alt="">
                        CUIDADO
                    </div>
                    <p class="desc">A temperatura e/ou umidade estão prestes a sair do controle. Monitore de perto e
                        tome medidas preventivas para garantir a saúde dos algodões.</p>
                </div>

                <div class="cada">
                    <div class="boxalerta">
                        <img width="50px" src="https://cdn-icons-png.flaticon.com/512/272/272340.png" alt="">
                        ALERTA
                    </div>
                    <p class="desc">A temperatura e/ou umidade estão fora do padrão. Recomendamos ação imediata para
                        evitar possíveis danos à plantação.</p>
                </div>
            </div>
        </section>
        <section id="section_tabelas" style="display: none;">
            <h1>Área das tabelas</h1>
        </section>

    </main>

</body>

</html>
<script src="../SiteDashboard/script.js"></script>
<script src="../SiteDashboard/trocarsecao.js"></script>
<script src="verificacao.js"></script>

<script>

    /* -- dht11Umidade -- */

    // Função para gerar números aleatórios entre um intervalo específico
    function generateRandomData() {
        var data = [];
        for (var i = 0; i < 5; i++) {
            data.push(Math.floor(Math.random() * 100)); // Gera números aleatórios entre 0 e 100
        }
        return data;
    }

    // Dados aleatórios para o gráfico
    var randomData = generateRandomData();

    // Criação do gráfico
    var contextoDht11Umidade = document.getElementById('dht11Umidade').getContext('2d');
    contextoDht11Umidade.canvas.width = 950;
    contextoDht11Umidade.canvas.height = 300;
    var dht11Umidade = new Chart(contextoDht11Umidade, {
        type: 'line',
        data: {
            labels: ['Data 1', 'Data 2', 'Data 3', 'Data 4', 'Data 5'],
            datasets: [{
                data: randomData,
                label: 'Umidade (%)',
                type: 'line',
                borderColor: ['#45b3e7'],
                backgroundColor: 'rgba(137, 207, 240, 0.6)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

    function updateChartData() {
        // Remove o primeiro elemento da matriz de labels
        dht11Umidade.data.labels.shift();
        // Adiciona uma nova label ao final da matriz de labels
        dht11Umidade.data.labels.push(getFormattedDateTime());
        // Remove o primeiro elemento da matriz de dados
        dht11Umidade.data.datasets[0].data.shift();
        // Adiciona um novo valor aleatório ao final da matriz de dados
        var newUmidad = Math.floor(Math.random() * 100);
        dht11Umidade.data.datasets[0].data.push(newUmidad);

        dht11Umidade.update();

        document.getElementById('umiData').innerHTML = `Umidade Atual:<br> ${newUmidad}`;

        if (newUmidad > 70) {
            // Atualiza o conteúdo e o estilo da div de texto para exibir o alerta
            document.getElementById('textboxUmi').innerHTML = '<img width="50px" src="https://cdn-icons-png.flaticon.com/512/272/272340.png" alt=""> Alerta: Umidade muito acima de 60%!';
            document.getElementById('textboxUmi').style.backgroundColor = 'red';
            document.getElementById('textboxUmi').style.color = 'white';
            document.getElementById('textboxUmi').style.border = '1px solid black';

        } else if (newUmidad >= 65 && newUmidad <= 69) {
            document.getElementById('textboxUmi').innerHTML = '<img width="50px" src="https://cdn-icons-png.flaticon.com/512/272/272340.png" alt=""> Cuidado: Umidade pouco acima de 60%!';
            document.getElementById('textboxUmi').style.backgroundColor = 'yellow';
            document.getElementById('textboxUmi').style.color = 'black';
            document.getElementById('textboxUmi').style.border = '1px solid black';
        }
        else if (newUmidad >= 50 && newUmidad <= 55) {
            document.getElementById('textboxUmi').innerHTML = '<img width="50px" src="https://cdn-icons-png.flaticon.com/512/272/272340.png" alt=""> Cuidado: Umidade pouco abaixo de 60%!';
            document.getElementById('textboxUmi').style.backgroundColor = 'yellow';
            document.getElementById('textboxUmi').style.color = 'black';
            document.getElementById('textboxUmi').style.border = '1px solid black';
        }
        else if (newUmidad < 49) {
            document.getElementById('textboxUmi').innerHTML = '<img width="50px" src="https://cdn-icons-png.flaticon.com/512/272/272340.png" alt=""> Alerta: Umidade muito abaixo de 60%!';
            document.getElementById('textboxUmi').style.backgroundColor = 'red';
            document.getElementById('textboxUmi').style.color = 'white';
            document.getElementById('textboxUmi').style.border = '1px solid black';
        } else {
            // Caso a temperatura não esteja acima de 35°C, limpa o conteúdo e o estilo da div de texto
            document.getElementById('textboxUmi').innerHTML = 'Tudo Sob-Controle Algodões Protegidos';
            document.getElementById('textboxUmi').style.backgroundColor = 'white';
            document.getElementById('textboxUmi').style.color = 'black';
            document.getElementById('textboxUmi').style.border = '1px solid black';
        }

        
    }

    // Chamada da função para atualizar os dados a cada intervalo de tempo (por exemplo, a cada segundo)
    setInterval(updateChartData, 3000); // 5000ms = 5 segundos

    // lm35Temperatura

    function generateRandomData1() {
        var data1 = [];
        for (var i = 0; i < 5; i++) {
            data1.push(Math.floor(Math.random() * 50)); // Gera números aleatórios entre 0 e 50
        }
        return data1;
    }

    // Dados aleatórios para o gráfico
    var randomData1 = generateRandomData1();

    // Criação do gráfico
    var contextoLm35Temperatura = document.getElementById('lm35Temperatura').getContext('2d');
    contextoLm35Temperatura.canvas.width = 950;
    contextoLm35Temperatura.canvas.height = 300;
    var lm35Temperatura = new Chart(contextoLm35Temperatura, {
        type: 'line',
        data: {
            labels: ['Data 1', 'Data 2', 'Data 3', 'Data 4', 'Data 5'],
            datasets: [{
                data: randomData1,
                label: 'Temperatura (°C)',
                type: 'line',
                borderColor: ['#ffd902'],
                backgroundColor: 'rgba(255, 225, 53, 0.6)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

    function updateChartData1() {
        // Remove o primeiro elemento da matriz de labels
        lm35Temperatura.data.labels.shift();
        // Adiciona uma nova label ao final da matriz de labels
        lm35Temperatura.data.labels.push(getFormattedDateTime());
        // Remove o primeiro elemento da matriz de dados
        lm35Temperatura.data.datasets[0].data.shift();
        // Adiciona um novo valor aleatório ao final da matriz de dados
        var newTemperature = Math.floor(Math.random() * 50);
        lm35Temperatura.data.datasets[0].data.push(newTemperature);
        // Atualiza o gráfico
        lm35Temperatura.update();

        document.getElementById('tempData').innerHTML = `Temperatura Atual:<br> ${newTemperature}`;

        // Verifica se a temperatura ultrapassou 35°C
        if (newTemperature > 30) {
            // Atualiza o conteúdo e o estilo da div de texto para exibir o alerta
            document.getElementById('textboxTemp').innerHTML = '<img width="50px" src="https://cdn-icons-png.flaticon.com/512/272/272340.png" alt=""> Alerta: Temperatura acima de 30°C!';
            document.getElementById('textboxTemp').style.backgroundColor = 'red';
            document.getElementById('textboxTemp').style.color = 'white';
            document.getElementById('textboxTemp').style.border = '1px solid black';

        } else if (newTemperature >= 28 && newTemperature <= 29) {
            document.getElementById('textboxTemp').innerHTML = '<img width="50px" src="https://cdn-icons-png.flaticon.com/512/272/272340.png" alt=""> Cuidado: Temperatura próxima de 30°C!';
            document.getElementById('textboxTemp').style.backgroundColor = 'yellow';
            document.getElementById('textboxTemp').style.color = 'black';
            document.getElementById('textboxTemp').style.border = '1px solid black';
        }
        else if (newTemperature >= 21 && newTemperature <= 22) {
            document.getElementById('textboxTemp').innerHTML = '<img width="50px" src="https://cdn-icons-png.flaticon.com/512/272/272340.png" alt=""> Cuidado: Temperatura próxima de 20°C!';
            document.getElementById('textboxTemp').style.backgroundColor = 'yellow';
            document.getElementById('textboxTemp').style.color = 'black';
            document.getElementById('textboxTemp').style.border = '1px solid black';
        }
        else if (newTemperature < 20) {
            document.getElementById('textboxTemp').innerHTML = '<img width="50px" src="https://cdn-icons-png.flaticon.com/512/272/272340.png" alt=""> Alerta: Temperatura abaixo de 20°C!';
            document.getElementById('textboxTemp').style.backgroundColor = 'red';
            document.getElementById('textboxTemp').style.color = 'white';
            document.getElementById('textboxTemp').style.border = '1px solid black';
        } else {
            // Caso a temperatura não esteja acima de 35°C, limpa o conteúdo e o estilo da div de texto
            document.getElementById('textboxTemp').innerHTML = 'Tudo Sob-Controle Algodões Protegidos';
            document.getElementById('textboxTemp').style.backgroundColor = 'white';
            document.getElementById('textboxTemp').style.color = 'black';
            document.getElementById('textboxTemp').style.border = '1px solid black';
        }
    }

    function getFormattedDateTime() {
    var now = new Date();
    var formattedDateTime = now.toLocaleString(); // Obtém a data e hora atual no formato local
    return formattedDateTime;
}

    // Chamada inicial da função para garantir que os dados sejam atualizados assim que a página for carregada
    updateChartData1();

    // Chamada da função para atualizar os dados a cada intervalo de tempo (por exemplo, a cada cinco segundos)
    setInterval(updateChartData1, 3000); // 5000ms = 5 segundos



    function updateDateTime() {
        var now = new Date();
        var datetimeElement = document.getElementById('tempo');
        var datetimeElement1 = document.getElementById('tempo1');
        datetimeElement.innerHTML = 'Data e Hora Atuais: ' + now.toLocaleString(); // Exibe a data e hora no formato local
        datetimeElement1.innerHTML = 'Data e Hora Atuais: ' + now.toLocaleString(); // Exibe a data e hora no formato local
    }

    // Chama inicialmente a função para exibir a data e hora atual
    updateDateTime();

    // Chama a função a cada segundo para manter a data e hora atualizada
    setInterval(updateDateTime, 1000); // 1000ms = 1 segundo

   

</script>

